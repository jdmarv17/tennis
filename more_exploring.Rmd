---
title: "more_exploring"
author: "Josh Marvald"
date: "5/29/2020"
output: html_document
---

```{r}
# variable for ranking inside top 30 or outside top 30
gs_matches_final2 <-
  gs_matches_final %>%
  mutate(top30 = case_when(
    win == 0 & loser_rank <= 30 ~ "top30",
    win == 0 & loser_rank > 30 ~ "outside_top30",
    win == 0 & is.na(loser_rank) == TRUE ~ "outside_top30",
    win == 1 & winner_rank <= 30 ~ "top30",
    win == 1 & winner_rank > 30 ~ "outside_top30",
    win == 1 & is.na(winner_rank) == TRUE ~ "outside_top30"
  )) %>%
  mutate(opponent_top30 = case_when(
    win == 0 & winner_rank <= 30 ~ "top30",
    win == 0 & winner_rank > 30 ~ "outside_top30",
    win == 0 & is.na(winner_rank) == TRUE ~ "outside_top30",
    win == 1 & loser_rank <= 30 ~ "top30",
    win == 1 & loser_rank > 30 ~ "outside_top30",
    win == 1 & is.na(loser_rank) == TRUE ~ "outside_top30"
  ))
```


```{r}
# win vs first serve

ggplot(gs_matches_final2, aes(x = first_serve, y = win, color = opponent_top30)) +
  geom_jitter(height = 0.12, alpha = 0.1) +
  stat_smooth(method = "glm", method.args = c("binomial")) +
  theme_bw()

gs_matches_final2 %>%
  filter(player == "Roger Federer") %>%
  ggplot(., aes(x = first_serve, y = win, color = opponent_top30)) +
  geom_jitter(height = 0.12, alpha = 0.25) +
  stat_smooth(method = "glm", method.args = c("binomial")) +
  theme_bw()
# plot supports theory

gs_matches_final2 %>%
  filter(player == "Rafael Nadal") %>%
  ggplot(., aes(x = first_serve, y = win, color = opponent_top30)) +
  geom_jitter(height = 0.12, alpha = 0.25) +
  stat_smooth(method = "glm", method.args = c("binomial")) +
  theme_bw()
# still showing downward trend for nadal

gs_matches_final2 %>%
  filter(player == "Novak Djokovic") %>%
  ggplot(., aes(x = first_serve, y = win, color = opponent_top30)) +
  geom_jitter(height = 0.12, alpha = 0.25) +
  stat_smooth(method = "glm", method.args = c("binomial")) +
  theme_bw()
# novaks top30 line is nearly straight -- him winning not dependent on his serve percentage?
```

```{r}
# win vs second serve

ggplot(gs_matches_final2, aes(x = second_serve, y = win, color = opponent_top30)) +
  geom_jitter(height = 0.12, alpha = 0.1) +
  stat_smooth(method = "glm", method.args = c("binomial")) +
  theme_bw() +
  coord_cartesian(xlim = c(.5, 1))

gs_matches_final2 %>%
  filter(player == "Roger Federer") %>%
  ggplot(., aes(x = second_serve, y = win, color = opponent_top30)) +
  geom_jitter(height = 0.12, alpha = 0.25) +
  stat_smooth(method = "glm", method.args = c("binomial")) +
  theme_bw()

gs_matches_final2 %>%
  filter(player == "Rafael Nadal") %>%
  ggplot(., aes(x = second_serve, y = win, color = opponent_top30)) +
  geom_jitter(height = 0.12, alpha = 0.25) +
  stat_smooth(method = "glm", method.args = c("binomial")) +
  theme_bw() +
  stat_smooth(aes(x = first_serve), colour = "black")
## something like this?
## I would also knit this file to make sure it runs from start to finish...
## you'll probably need to add some stuff at the beginning in order to make
## that happen


gs_matches_final2 %>%
  filter(player == "Novak Djokovic") %>%
  ggplot(., aes(x = second_serve, y = win, color = opponent_top30)) +
  geom_jitter(height = 0.12, alpha = 0.25) +
  stat_smooth(method = "glm", method.args = c("binomial")) +
  theme_bw() 


## is it possible to look at lines for first and second serve at the same time?
## the only reason I can think of for downward sloping lines is if one statistic is 
## high while the other is low and then flips
```

All of this is really getting at having a random effect for the opponent. It would still be possible to include this and still make the Shiny app for different players. You'd end up setting the random effect for opponent to 0 to get this "global" graph of effect of first serve percentage on winning while also actually accounting for the level of the opponent within the model. But at some point, we'll have to think about balancing time with the extra work that this would entail. Something to just think about for now (no need to do anything with it, at least until we finish the mixed effects document thing).

I think this would be the way to go if possible.  See Figure 8.15 on this document we've been reading: <https://bookdown.org/roback/bookdown-bysh/ch-multilevelintro.html> That really sums up the issue at hand. It might also be helpful to come up with an example in this data set. It won't be as "clear" as the toy example in this book but it could help get the point across.







